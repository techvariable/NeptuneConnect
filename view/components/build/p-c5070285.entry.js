import{r as t,h as s,H as e,g as i}from"./p-62aab1e1.js";import{E as o,j as r,g as a,k as l,Y as n}from"./p-8b9b63ba.js";import{a as h}from"./p-18b27c92.js";import{f as c,a as d,h as u}from"./p-02c57b85.js";import{c as m}from"./p-e9f9174b.js";const p=".sc-permission-editor-h{display:block}";let f=o.theme({"&":{color:"white",backgroundColor:"#034"},".cm-content":{caretColor:"#0e9"},"&.cm-focused .cm-cursor":{borderLeftColor:"#0e9"},"&.cm-focused .cm-selectionBackground, ::selection":{backgroundColor:"#074"},".cm-gutters":{backgroundColor:"#045",color:"#ddd",border:"none"}},{dark:true});const b=new n;let g=class{constructor(s){t(this,s);this.parsedPermissions=[];this.isLoading=false;this.errorMessage="";this.roles=[];this.resStatus="";this.syncVal=""}async onRoleSelect(t){this.errorMessage="";this.resStatus="";const s=t.target.value;this.selectedRole=s;const e=await h.get(`${this.url}/?roleId=${s}`);let i=this.view.state.update({changes:{from:0,to:this.view.state.doc.toString().length,insert:`${c(e.data)}`}});this.view.dispatch(i)}async fetchRolePermission(t){try{const s=await h.get(`${this.url}/?roleId=${t}`);let e=this.view.state.update({changes:{from:0,to:this.view.state.doc.toString().length,insert:`${c(s.data)}`}});this.view.dispatch(e)}catch(t){console.log(t)}}async fetchRoles(){try{const t=await h.get(`${this.url}/all`);const s=t.data;if(s instanceof Array&&s.length>0){this.selectedRole=s[0].id;this.roles=s;await this.fetchRolePermission(s[0].id)}}catch(t){console.log({error:t})}}componentDidLoad(){const t=[m,r(),o.updateListener.of((t=>{this.syncVal=t.state.doc.toString().trim()})),this.dummyKeymap()];if(localStorage.getItem("themesArray")==="dark"){t.push(b.of([f]))}this.state=a.create({doc:"\n\n\n\n",extensions:t});this.view=new o({state:this.state,parent:this.element.querySelector("#permissionEditor")});this.parsedPermissions=JSON.parse(this.permissions||"[]");this.fetchRoles()}async onRoleUpdateClick(){var t,s;if(this.syncVal!==""){try{this.isLoading=true;this.errorMessage="";this.resStatus="";let t=this.view.state.update();this.view.dispatch(t);const{isValid:s,error:e}=d(String(t.state.doc));if(s){this.isLoading=true;const s=String(t.state.doc);const e=await h.put(this.url,{permissions:s,roleId:this.selectedRole});this.resStatus=`Permissions for ${e.data.roleName} updated successfully`}else{this.errorMessage=e}}catch(e){console.error(e);this.errorMessage=((s=(t=e===null||e===void 0?void 0:e.response)===null||t===void 0?void 0:t.data)===null||s===void 0?void 0:s.message)||"Failed to update the permission"}this.isLoading=false}}async onRoleDeleteHandler(){if(this.syncVal!==""){try{this.isLoading=true;this.errorMessage="";this.resStatus="";let t=this.view.state.update();this.view.dispatch(t);this.isLoading=true;const s=await h.delete(`${this.url}/?roleId=${this.selectedRole}`);if(s.data.isDeleted===true){this.resStatus=`${s.data.deletedPermissionName} is deleted successfully`;this.isLoading=false;this.errorMessage="";this.fetchRoles()}}catch(t){if(t.response.data.isDeleted===false){this.isLoading=false;this.errorMessage=`${t.response.data.deletedPermissionName} is assigned to  ${t.response.data.usersWithAssignedRole.length} user with email \n\n ${t.response.data.usersWithAssignedRole.join(",")}`}else if(t.response.data.message){this.isLoading=false;this.errorMessage=`${t.response.data.message}`}}this.isLoading=false}}dummyKeymap(){let t=this.onRoleUpdateClick;return l.of([{key:"Ctrl-Shift-Enter",run(){t();return true}}])}render(){return s(e,null,s("div",{class:"w-auto border rounded-md border-gray-300 shadow-gray-300 py-2 px-3 space-y-2"},s("div",{class:"flex justify-between items-center"},s("div",{class:"border border-gray-300 space-x-3 rounded-md shadow-gray-300 p-2 m-1"},s("span",{class:"pb-6 text-md font-bold leading-7 text-gray-600"},"Select Role : "),s("select",{onChange:t=>this.onRoleSelect(t),class:"form-select px-3 py-1.5 border-none text-inherit font-inherit text-gray-700 bg-transparent bg-clip-padding bg-no-repeat rounded-md transition ease-in-out focus:text-gray-700 focus:bg-white focus:border-blue-600 focus:outline-none"},this.roles.map((t=>s("option",{class:"rounded-md hover:bg-gray-200 hover:text-gray-600",selected:this.selectedRole===t.id,value:`${t.id}`},t.roleName))))),s("add-role",{parsedPermissions:this.parsedPermissions,refresh:()=>this.fetchRoles(),url:this.url})),s("div",{style:{maxHeight:"40rem",overflowY:"auto"},class:"border-2 custom-scrollbar "},s("div",{id:"permissionEditor",class:"border border-gray-300"})),this.errorMessage!==""?s("p",{class:"px-3 py-2 bg-indigo-200 text-indigo-800 border-l-4 border-indigo-600 w-full -mt-4 mb-6"},this.errorMessage):null,this.errorMessage===""&&this.resStatus!==""&&s("div",{class:"flex items-center bg-gray-500 text-white text-sm font-bold px-4 py-3",role:"alert"},s("p",null,this.resStatus)),s("div",{class:"flex justify-between gap-4"},s("div",{class:"flex gap-4"},s("icon-label-submit-button",{title:"Update Role",clickHandler:()=>this.onRoleUpdateClick(),disabled:this.syncVal===""||!u(this.parsedPermissions,{name:"permissions",permission:"update"})||this.isLoading,loading:this.isLoading,varient:"outlined",color:"primary"},"Update"),s("icon-label-submit-button",{title:"Delete Current Role",clickHandler:()=>this.onRoleDeleteHandler(),disabled:this.syncVal===""||!u(this.parsedPermissions,{name:"permissions",permission:"delete"})||this.isLoading,varient:"outlined",color:"primary"},"Delete")),s("div",{class:"mx-4"},this.isLoading&&s("loader-component",null)))))}get element(){return i(this)}};g.style=p;export{g as permission_editor};
//# sourceMappingURL=p-c5070285.entry.js.map